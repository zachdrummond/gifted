<main class="grid-container">
  {{!-- Website Name --}}
  <header class="grid-x grid-padding-x align-center">
    <h1>Gifted</h1>
  </header>
  {{!-- Page Title --}}
  <div class="grid-x grid-padding-x align-center">
    <h2 class="text-center">Gifts You Sent</h2>
  </div>
  {{!-- Add Button --}}
  <div class="grid-x grid-padding-x align-center">
    <a href="/add/sent" class="button">Add a New Gift</a>
  </div>
  {{!-- Table --}}
  <section class="grid-x grid-padding-x align-center">
    <table class="hover">
      <thead>
        <tr>
          <th width="150">Gift You Sent</th>
          <th width="150">Date Sent</th>
          <th width="150">Occasion</th>
          <th width="150">Cost</th>
          <th width="150">Receiver's Name</th>
          <th width="150">Receiver's Address</th>
          <th width="150">Edit/Delete</th>
        </tr>
      </thead>
      <tbody>
        {{#each gifts}}
        <tr>
          <td>{{giftSent}}</td>
          <td>{{dateSent}}</td>
          <td>{{occasion}}</td>
          <td>${{cost}}</td>
          <td>{{receiverName}}</td>
          <td>{{receiverAddress}}</td>
          <td><button data-id="{{id}}" type="button" class="editbtn small button success">edit</button>
            <button data-id="{{id}}" type="button" class="deletebtn small button alert">delete</button></td>
        </tr>
        {{/each}}
      </tbody>
    </table>
  </section>
</main>

<script>
  $(document).ready(function () {
    $(document).foundation();
    $(".deletebtn").on("click", function (event) {

      let id = $(this).data("id");

      $.ajax("/api/sent/" + id, {
        type: "DELETE",
      }).then(() => {
        location.reload();
      });
    });
// targets values when clicked, still need to figure out how to edit it
    $(".editbtn").on("click", function (event) {

      if ($(this).text() === "edit") {
        $(this).text("submit");

        const tableRow = $(this).parent().siblings();
// update visible state
        for (let i = 0; i < tableRow.length; i++) {
          tableRow[i].children[0].setAttribute("class", "displayNone");
          tableRow[i].children[1].removeAttribute("class");
        }
      } else if ($(this).text() === "submit") {
        $(this).text("edit");

        const id = $(this).data("id");
        const userId = 1;

        const editedGift = {
          id: id,
          user_id: userId,
          receiverName: $("#editedReceiver" + id).val(),
          receiverAddress: $("#editedAddress" + id).val(),
          giftSent: $("#editedGift" + id).val(),
          occasion: $("#editedOccasion" + id).val(),
          dateSent: $("#editedDate" + id).val(),
          cost: $("#editedCost" + id).val(),
        };
        console.log(editedGift)
        $.ajax("/api/edit/received", { type: "PUT", data: editedGift }).then(() => { location.reload() });
      }
    });
  });
</script>