<main class="grid-container">
  {{!-- Page Title --}}
  <div class="grid-x grid-padding-x align-center">
    {{!-- <img data-interchange="[/images/banner1.png, small], [/images/banner1.png, medium], [/images/banner1.png, large]"> --}}
    <h2 class="text-center">Gifts Received</h2>
  </div>
  {{!-- Add Button --}}
  <div class="grid-x grid-padding-x align-center">
    <a href="/add/received" class="button btnBlue">Add a New Gift</a>
  </div>
  {{!-- Table --}}
  <section class="grid-x grid-padding-x align-center">
    <table class="hover">
      <thead>
        <tr>
          <th width="150">Gift</th>
          <th width="150">Date Received</th>
          <th width="150">Occasion</th>
          <th width="150">Sender's Name</th>
          <th width="150">Sender's Address</th>
          <th width="150">Thank You</th>
          <th width="150">Edit/Delete</th>
        </tr>
      </thead>
      <tbody>
        <div class="medium-4 cell">
                <button id="orderByDate" data-open="addModalSent" class="submit button expanded btnBlue">Order By Date</button>
            </div>
        {{#each gifts}}
        <tr>
          <td><span>{{giftReceived}}</span><input id="editedGift{{id}}" type="text" value="{{giftReceived}}"
              class="displayNone"></td>
          <td><span>{{dateReceived}}</span><input id="editedDate{{id}}" type="text" value="{{dateReceived}}"
              class="displayNone"></td>
          <td><span>{{occasion}}</span><input id="editedOccasion{{id}}" type="text" value="{{occasion}}"
              class="displayNone">
          </td>
          <td><span>{{senderName}}</span><input id="editedSender{{id}}" type="text" value="{{senderName}}"
              class="displayNone"></td>
          <td><span>{{senderAddress}}</span><input id="editedAddress{{id}}" type="text" value="{{senderAddress}}"
              class="displayNone"></td>
          <td><span>{{#if thankYou}}Sent{{else}}Not Sent{{/if}}</span>
            <input class="displayNone" type="radio" name="thankYou" value=true id="sent" required><label
              class="displayNone" for="Sent">Y</label>
            <input class="displayNone" type="radio" name="thankYou" value=false id="notSent"><label class="displayNone"
              for="Not Sent">N</label>

          </td>
          <td><button data-id="{{id}}" type="button" class="editbtn small button btnGreen">edit</button>
            <button data-id="{{id}}" type="button" data-open="modalReceived"
              class="deletebtn small button btnRed">delete</button></td>
        </tr>
        {{/each}}
      </tbody>
    </table>
  </section>
</main>

{{!-- Added successfully modal --}}
<div class="reveal text-center" id="modalReceived" data-reveal>
  <h1>Success!</h1>
  <p class="lead">Your gift was deleted!</p>
  <button id="modalClose" class="close-button" data-close aria-label="Close modal" type="button">
    <span aria-hidden="true">&times;</span>
  </button>
</div>

<script>
  $(document).ready(function () {

    // Sets up Foundation JavaScript
    $(document).foundation();

    $("#orderByDate").on("click", function (event) {
      window.location.href = "/received/date"
    });

    // Edit Button Event Listener
    $(".editbtn").on("click", function (event) {

      if ($(this).text() === "edit") {
        $(this).text("submit");

        const tableRow = $(this).parent().siblings();
        // update visible state
        for (let i = 0; i < tableRow.length - 1; i++) {
          tableRow[i].children[0].setAttribute("class", "displayNone");
          tableRow[i].children[1].removeAttribute("class");
        }
        tableRow[5].children[0].setAttribute("class", "displayNone");
        for (let j = 1; j < 5; j++) {
          tableRow[5].children[j].removeAttribute("class");
        }
      } else if ($(this).text() === "submit") {
        $(this).text("edit");

        const id = $(this).data("id");
        const userId = 1;

        const editedGift = {
          id: id,
          user_id: userId,
          senderName: $("#editedSender" + id).val(),
          senderAddress: $("#editedAddress" + id).val(),
          giftReceived: $("#editedGift" + id).val(),
          occasion: $("#editedOccasion" + id).val(),
          dateReceived: $("#editedDate" + id).val(),
          thankYou: $('input[name="thankYou"]:checked').val(),
        };
        console.log(editedGift)
        $.ajax("/api/edit/received", { type: "PUT", data: editedGift }).then(() => { location.reload() });
      }
    });

    // Delete Button Event Listener
    $(".deletebtn").on("click", function (event) {

      const id = $(this).data("id");

      // AJAX Call - Delete Table Row
      $.ajax("/api/received/" + id, {
        type: "DELETE",
      }).then(() => {
        console.log("deleted");
      });
    });
  });
</script>